<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Shared utilities for lexical conversion routines."><title>lexical_util - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-1a91846b.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="lexical_util" data-themes="" data-resource-suffix="" data-rustdoc-version="1.88.0 (6b00bc388 2025-06-23)" data-channel="1.88.0" data-search-js="search-f7877310.js" data-settings-js="settings-5514c975.js" ><script src="../static.files/storage-4e99c027.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-7ef8a74a.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../lexical_util/index.html">lexical_<wbr>util</a><span class="version">1.0.6</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#features" title="Features">Features</a></li><li><a href="#note" title="Note">Note</a></li><li><a href="#version-support" title="Version Support">Version Support</a></li><li><a href="#safety-guarantees" title="Safety Guarantees">Safety Guarantees</a></li></ul><h3><a href="#modules">Crate Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#macros" title="Macros">Macros</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>lexical_util</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/lexical_util/lib.rs.html#1-180">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Shared utilities for lexical conversion routines.</p>
<p>These are not meant to be used publicly for any numeric
conversion routines, but provide optimized math routines,
format packed struct definitions, and custom iterators
for all workspaces.</p>
<h2 id="features"><a class="doc-anchor" href="#features">§</a>Features</h2>
<ul>
<li><code>std</code> - Use the standard library.</li>
<li><code>power-of-two</code> - Add support for parsing power-of-two integer strings.</li>
<li><code>radix</code> - Add support for strings of any radix.</li>
<li><code>write-integers</code> - Add support for writing integers.</li>
<li><code>write-floats</code> - Add support for writing floats.</li>
<li><code>parse-integers</code> - Add support for parsing integers.</li>
<li><code>parse-floats</code> - Add support for parsing floats.</li>
<li><code>compact</code> - Reduce code size at the cost of performance.</li>
</ul>
<h2 id="note"><a class="doc-anchor" href="#note">§</a>Note</h2>
<p>None of this is considered a public API: any of the implementation
details may change release-to-release without major or minor version
changes. Use internal implementation details at your own risk.</p>
<p>lexical-util mainly exists as an implementation detail for
lexical-core, although its API is stable. If you would like to use
a high-level API that writes to and parses from <code>String</code> and <code>&amp;str</code>,
respectively, please look at <a href="https://crates.io/crates/lexical">lexical</a>
instead. If you would like an API that supports multiple numeric
conversions, please look at <a href="https://crates.io/crates/lexical-core">lexical-core</a>
instead.</p>
<h2 id="version-support"><a class="doc-anchor" href="#version-support">§</a>Version Support</h2>
<p>The minimum, standard, required version is 1.63.0, for const generic
support. Older versions of lexical support older Rust versions.</p>
<h2 id="safety-guarantees"><a class="doc-anchor" href="#safety-guarantees">§</a>Safety Guarantees</h2>
<p>The only major sources of unsafe code are wrapped in the <code>iterator.rs</code>,
<code>skip.rs</code>, and <code>noskip.rs</code>. These are fully encapsulated into standalone
traits to clearly define safety invariants and localize any unsafety to
1 or 2 lines of code.</p>
<p>The core, unsafe trait is <code>DigitsIter</code> and <code>Iter</code>, both which expect
to be backed by a contiguous block of memory (a slice) but may skip
bytes internally. To guarantee safety, for non-skip iterators you
must implement <a href="https://github.com/Alexhuszagh/rust-lexical/blob/8fe1d9a/lexical-util/src/iterator.rs#L276">DigitsIter::is_consumed</a> correctly.</p>
<p>This must correctly determine if there are any elements left in the
iterator. If the buffer is contiguous, this can just be <code>index == self.len()</code>, but for a non-contiguous iterator it must skip any digits to
advance to the element next to be returned or the iterator itself will be
unsafe. <strong>ALL</strong> other safety invariants depend on this being implemented
correctly.</p>
<p>To see if the cursor is at the end of the buffer, use
<a href="https://github.com/Alexhuszagh/rust-lexical/blob/8fe1d9a/lexical-util/src/iterator.rs#76">is_buffer_empty</a>.</p>
<p>Any iterators must be peekable: you must be able to read and return the next
value without advancing the iterator past that point. For iterators that
skip bytes, this means advancing to the next element to be returned and
returning that value.</p>
<p>For examples of how to safely implement skip iterators, you can do something
like:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">impl</span>&lt;<span class="kw">_</span>&gt; DigitsIter&lt;<span class="kw">_</span>&gt; <span class="kw">for </span>MyIter {
    <span class="kw">fn </span>peek(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; <span class="prelude-ty">Option</span>&lt;u8&gt; {
        <span class="kw">loop </span>{
            <span class="kw">let </span>value = <span class="self">self</span>.bytes.get(<span class="self">self</span>.index)<span class="question-mark">?</span>;
            <span class="kw">if </span>value != <span class="kw-2">&amp;</span><span class="string">b'.' </span>{
                <span class="kw">return </span>value;
            }
            <span class="self">self</span>.index += <span class="number">1</span>;
        }
    }
}</code></pre></div>
<p>Then, <a href="https://doc.rust-lang.org/1.88.0/core/iter/traits/iterator/trait.Iterator.html#tymethod.next" title="method core::iter::traits::iterator::Iterator::next">next</a> will be implemented in terms
of <a href="https://github.com/Alexhuszagh/rust-lexical/blob/8fe1d9a/lexical-util/src/iterator.rs#L284">peek</a>, incrementing the position in the cursor just after the value.
The next iteration of peek will step to the correct byte to return.</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">impl</span>&lt;<span class="kw">_</span>&gt; Iterator <span class="kw">for </span>MyIter {
    <span class="kw">type </span>Item = <span class="kw-2">&amp;</span><span class="lifetime">'a </span>u8;

    <span class="kw">fn </span>next(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; <span class="prelude-ty">Option</span>&lt;<span class="self">Self</span>::Item&gt; {
        <span class="kw">let </span>value = <span class="self">self</span>.peek()<span class="question-mark">?</span>;
        <span class="self">self</span>.index += <span class="number">1</span>;
        <span class="prelude-val">Some</span>(value)
    }
}</code></pre></div>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><dl class="item-table"><dt><a class="mod" href="algorithm/index.html" title="mod lexical_util::algorithm">algorithm</a></dt><dd>Simple, shared algorithms for slices and iterators.</dd><dt><a class="mod" href="ascii/index.html" title="mod lexical_util::ascii">ascii</a></dt><dd>Utilities for working with ASCII characters.</dd><dt><a class="mod" href="assert/index.html" title="mod lexical_util::assert">assert</a></dt><dd>Debugging assertions to check a radix is valid.</dd><dt><a class="mod" href="constants/index.html" title="mod lexical_util::constants">constants</a></dt><dd>Pre-defined constants for numeric types.</dd><dt><a class="mod" href="digit/index.html" title="mod lexical_util::digit">digit</a></dt><dd>Utilities to process digits.</dd><dt><a class="mod" href="div128/index.html" title="mod lexical_util::div128">div128</a></dt><dd>Optimized division algorithms for u128.</dd><dt><a class="mod" href="error/index.html" title="mod lexical_util::error">error</a></dt><dd>Error type for numeric parsing functions.</dd><dt><a class="mod" href="extended_float/index.html" title="mod lexical_util::extended_float">extended_<wbr>float</a></dt><dd>Extended precision floating-point type.</dd><dt><a class="mod" href="format/index.html" title="mod lexical_util::format">format</a></dt><dd>Public API for the number format packed struct.</dd><dt><a class="mod" href="iterator/index.html" title="mod lexical_util::iterator">iterator</a></dt><dd>Specialized iterator traits.</dd><dt><a class="mod" href="mul/index.html" title="mod lexical_util::mul">mul</a></dt><dd>Fast multiplication routines.</dd><dt><a class="mod" href="num/index.html" title="mod lexical_util::num">num</a></dt><dd>Utilities for Rust numbers.</dd><dt><a class="mod" href="options/index.html" title="mod lexical_util::options">options</a></dt><dd>Shared traits for the options API.</dd><dt><a class="mod" href="result/index.html" title="mod lexical_util::result">result</a></dt><dd>Result type for numeric parsing functions.</dd><dt><a class="mod" href="step/index.html" title="mod lexical_util::step">step</a></dt><dd>The maximum digits that can be held in a u64 for a given radix without
overflow.</dd></dl><h2 id="macros" class="section-header">Macros<a href="#macros" class="anchor">§</a></h2><dl class="item-table"><dt><a class="macro" href="macro.from_lexical.html" title="macro lexical_util::from_lexical">from_<wbr>lexical</a></dt><dd>Define <code>FromLexical</code> trait.</dd><dt><a class="macro" href="macro.from_lexical_with_options.html" title="macro lexical_util::from_lexical_with_options">from_<wbr>lexical_<wbr>with_<wbr>options</a></dt><dd>Define <code>FromLexicalWithOptions</code> trait.</dd><dt><a class="macro" href="macro.to_lexical.html" title="macro lexical_util::to_lexical">to_<wbr>lexical</a></dt><dd>Define <code>ToLexical</code> trait.</dd><dt><a class="macro" href="macro.to_lexical_with_options.html" title="macro lexical_util::to_lexical_with_options">to_<wbr>lexical_<wbr>with_<wbr>options</a></dt><dd>Define <code>ToLexicalWithOptions</code> trait.</dd></dl></section></div></main></body></html>